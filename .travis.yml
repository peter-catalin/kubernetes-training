# Tell Travis that we want sudo privileges
sudo: required

# Tell Travis that we need docker in order to build
services:
  - docker

before_install:
  # This is the result of encrypting the file with the Travis CLI tool described below in step 3.
  - openssl aes-256-cbc -K $encrypted_0c35eebf403c_key -iv $encrypted_0c35eebf403c_iv -in service-account.json.enc -out service-account.json -d
  # Download and install the Google Cloud SDK
  - curl https://sdk.cloud.google.com | bash > /dev/null;
  - source $HOME/google-cloud-sdk/path.bash.inc
  # Install the kubectl command
  - gcloud components update kubectl
  # Authorize the Google Cloud SDK so that Travis can modify our Kubernetes cluster.
  # In order for this to work we need to do a couple of things.
  # 1. Create a service-account in the Google Cloud Console.
  # 2. Download the .json file generated by step 1.
  # 3. Download the Travis CI CLI tool, encrypt the .json file and upload it to Travis CI.
  - gcloud auth activate-service-account --key-file service-account.json
